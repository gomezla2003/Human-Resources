<?xml version="1.0" encoding="UTF-8"?><record_update sys_domain="global" table="sys_cb_design_topic">
    <sys_cb_design_topic action="INSERT_OR_UPDATE">
        <compiled_topic display_value="HR Case (LG)">f2e946ccdb44801440f8fcfa0c961903</compiled_topic>
        <design_definition>{"type":"FlowTopic","triggers":[{"type":"Trigger","name":"792aa5df3e2743f886929b2ac20baed9","triggerType":"request","applicability":{"type":"Applicability","mode":"script","value":""},"id":"792aa5df3e2743f886929b2ac20baed9"}],"goals":[{"name":"Create Incident","trigger_id":"792aa5df3e2743f886929b2ac20baed9","nodes":[{"type":"StartGoal","goal_id":"1382a1d852f44769a78cc05663b2e12c","greeting_msg":{"type":"String","mode":"string","value":""},"id":"c22d8894214543288554a1331878a93e","name":"Start"},{"type":"TerminateGoal","goal_id":"1382a1d852f44769a78cc05663b2e12c","confirmation_msg":{"type":"String","mode":"string","value":"gs.getMessage(\"Thanks for using our support chat! Have a great day!\")"},"id":"eb9cee4423044f1b95bb6cda682f0c0b","name":"End"},{"type":"InputPrompt","variable_id":"4d2c1dcfdea04900aa19316a14aebc59","message":{"type":"String","mode":"string","value":"gs.getMessage(\"Please enter a short description of your issue.\")"},"optional":false,"id":"34a70a135f0d4f8ba10772a83b4972d0","name":"Short Description","goal_id":"1382a1d852f44769a78cc05663b2e12c"},{"type":"ScriptOutputPrompt","output_type":"single_part","id":"a9c5b9119d2e4a9185f749f8539291f1","name":"Contextual Search","goal_id":"1382a1d852f44769a78cc05663b2e12c","value":{"type":"String","mode":"string","value":"(function execute() {\n    var search_term = vaInputs.short_description;\n    var context = '2821675a5b30130070e4492c11f91a89';\n\n    var contextualSearch = new sn_itsm_va.VAContextualSearchUtil();\n    var response = contextualSearch.search(context, search_term);\n\n    var success = contextualSearch.processSearchResponse(response);\n    if (!success) {\n        vaVars.count = 0;\n        return '';\n    }\n\n    var relevantSearchResults = contextualSearch.processGeneralResults(response, vaVars.limit, 0);\n    vaVars.count = relevantSearchResults.length;\n    if (vaVars.count == 0) {\n        return '';\n    }\n\n    var htmlhead =  gs.getMessage(\"OK. Before creating your incident, here are some KB articles that may help.\") +\n                \"\\r\\n &lt;table style=\\\"width: 100%;\\\"&gt;\\r\\n \" + \n                \"&lt;col width=\\\"33%\\\"&gt;\\r\\n \" +\n                \"&lt;col width=\\\"67%\\\"&gt;\\r\\n\" + \n                \"&lt;tr&gt;\\r\\n\\t&lt;td&gt;&lt;b&gt;\" + gs.getMessage('KB Number') + \"&lt;/b&gt;&lt;/td&gt;\\r\\n  \" + \n                \"\\t&lt;td&gt;&lt;b&gt;\" + gs.getMessage('Short Description') + \"&lt;/b&gt;&lt;/td&gt;\\r\\n&lt;/tr&gt;\";\n    var htmlline =  \"&lt;tr style=\\\"vertical-align:top\\\"&gt;\\r\\n\\t&lt;td&gt;&lt;a target=\\\"_blank\\\" \"+ \n                    \"href=\\\"###LINK###\\\"&gt;\" +\n                    \"###NUMBER###&lt;/a&gt;&lt;/td&gt;\\r\\n\\t&lt;td&gt;###TITLE###&lt;/td&gt;\\r\\n&lt;/tr&gt;\";\n    var htmltail = \"&lt;/table&gt;\";\n\n    var htmlbuilder = \"\" + htmlhead;\n    for (var i = 0; i &lt; vaVars.count; i++) {\n        var sysId = relevantSearchResults[i].id.split(':')[1];\n        htmlbuilder += \n            htmlline.replace(\"###LINK###\",  gs.getProperty('glide.servlet.uri') + '/' +\n                        gs.getProperty('sn_itsm_va.com.snc.itsm.virtualagent.portal_url') +\n                        '?id=kb_article&amp;sys_id=' + sysId)\n                    .replace(\"###NUMBER###\", relevantSearchResults[i].meta.number)\n                    .replace(\"###TITLE###\", relevantSearchResults[i].title);\n        \n    }\n    htmlbuilder += htmltail;\n    \n    return htmlbuilder;\n})()\n"}},{"type":"Decision","name":"Decision","branches":[{"type":"Branch","label":"Has Results","expression":{"type":"Applicability","mode":"script","value":"(function execute() {\n    return (parseInt(vaVars.count) != 0);\n})()\n"},"id":"9390650143b94e5ebaff56fd8721ed08","name":"Has Results"},{"type":"Branch","label":"No Results","expression":{"type":"Applicability","mode":"script","value":"(function execute() {\n    return (parseInt(vaVars.count) == 0);\n})()\n"},"id":"1649bd28d89044549598846105f24782","name":"No Results"}],"id":"183718c46b6f4bedaad8b1b71fb5e28b","goal_id":"1382a1d852f44769a78cc05663b2e12c"},{"type":"InputPrompt","variable_id":"9a9b464e0ec1425ea8619697cf4b469f","message":{"type":"String","mode":"script","value":"(function execute() {\n    if (vaVars.total_results == 1) {\n        return gs.getMessage('Did this KB article resolve your issue?');\n    }\n    return gs.getMessage('Did any of these articles resolve your issue?');\n})()\n"},"optional":false,"id":"9b3c8873e2c04a0bb037f45a89791484","name":"Is Helpful","goal_id":"1382a1d852f44769a78cc05663b2e12c"},{"type":"Decision","name":"Decision","branches":[{"type":"Branch","label":"Helpful","expression":{"type":"Applicability","mode":"script","value":"(function execute() {\n    return vaInputs.is_helpful.getValue();\n})()\n"},"id":"1ec17f6a4b0748e587221d9032e82f60","name":"Helpful"},{"type":"Branch","label":"Not Helpful","expression":{"type":"Applicability","mode":"script","value":"(function execute() {\n    return !vaInputs.is_helpful.getValue();\n})()\n"},"id":"e64c9890045240fd9eca0c9279ed15bf","name":"Not Helpful"}],"id":"567d71473fb9439ab6e3f18f07524dbd","goal_id":"1382a1d852f44769a78cc05663b2e12c"},{"type":"OutputPrompt","value":{"type":"String","mode":"string","value":"gs.getMessage(\"Alright, I've opened your case and a HR service rep will be assigned. \")"},"id":"df9335dbb94b47ec9213400d9fcd6a59","name":"Acknowledgement","goal_id":"1382a1d852f44769a78cc05663b2e12c"},{"type":"ScriptOutputPrompt","output_type":"single_part","id":"071db397feec4a36b72e9ba81db270e3","name":"Incident Card","goal_id":"1382a1d852f44769a78cc05663b2e12c","value":{"type":"String","mode":"string","value":"(function execute() {\n      var incident = new GlideRecordSecure('incident');\n      incident.get(vaInputs.create_incident);\n\n      var title = {\n            url: gs.getProperty('glide.servlet.uri') + '/' +\n                  gs.getProperty('sn_itsm_va.com.snc.itsm.virtualagent.portal_url') + \n                  '?sys_id=' + incident.sys_id + '&amp;id=ticket&amp;table=incident',\n            label: incident.number\n      };\n\n      var fieldList = ['category', 'assignment_group', 'short_description', 'state'];\n      var cardRenderer = new global.VaRecordCardRenderer(true);\n      var fields = cardRenderer.createFields(fieldList, incident);\n      var html = cardRenderer.renderCard(title, fields);\n      return html;\n})();"}},{"type":"Decision","name":"Decision","branches":[{"type":"Branch","label":"Description Is Not Empty","expression":{"type":"Applicability","mode":"script","value":"(function execute() {\n    return (vaInputs.short_description.getValue().trim() != '');\n})()\n"},"id":"7288e8af3182464ebf1dc7f09fc3aa0c","name":"Description Is Not Empty"},{"type":"Branch","label":"Description Is Empty","expression":{"type":"Applicability","mode":"script","value":"(function execute() {\n    return (vaInputs.short_description.getValue().trim() == '');\n})()\n"},"id":"a3697c2313684bb18349056317ed1608","name":"Description Is Empty"}],"id":"4441afeadc05411b96341a6c5238a400","goal_id":"1382a1d852f44769a78cc05663b2e12c"},{"type":"ScriptedAction","script":"(function execute() {\n    var incident = new GlideRecord('x_sthc_human_resou_hr_case_service_center');\n    incident.initialize();\n    incident.caller = vaInputs.user;\n    incident.short_description = vaInputs.short_description;\n    incident.urgency = vaInputs.urgency;\n    incident.contact_type = 'virtual_agent';\n    vaInputs.create_incident = incident.insert();\n    return vaInputs.create_incident;\n})();","id":"0ba1f831cc06485faae3ce73a51a8cba","name":"Create Incident","goal_id":"1382a1d852f44769a78cc05663b2e12c"},{"type":"ReferenceChoiceInputPrompt","mode":"external","id":"03290de6059a4beaaa4b43668bdb6723","name":"Urgency","goal_id":"1382a1d852f44769a78cc05663b2e12c","variable_id":"6c9248abe9d840c6b134f0e237fe0569","message":{"type":"String","mode":"script","value":"(function execute() {\n    if (vaVars.count &gt; 0) {\n        return gs.getMessage('OK, what\\'s the Category of your issue?');\n    }\n    return gs.getMessage('What\\'s the Category of your issue?');\n})()"},"optional":false,"expression_mode":"script","script":"(function execute() {\n    var choices = new GlideChoiceList();\n    // Getting all the choices for urgency.\n    var choiceList = choices.getChoiceList('x_sthc_human_resou_hr_case_service_center', 'category');\n    \n    var options = [];\n\n    for (var i=0; i &lt; choiceList.getSize(); i++) {\n        options.push({'value': choiceList.getChoice(i).getValue(), 'label': choiceList.getChoice(i).getLabel()});\n    }\n    \n    return options;    \n})()\n","no_options_found_message":{"type":"String","mode":"string","value":"No Records Found"}}],"edges":[{"type":"Edge","source_node_id":"03290de6059a4beaaa4b43668bdb6723","target_node_id":"0ba1f831cc06485faae3ce73a51a8cba","id":"c10cdb08d43849429d6a226bd99560be"},{"type":"Edge","source_node_id":"0ba1f831cc06485faae3ce73a51a8cba","target_node_id":"df9335dbb94b47ec9213400d9fcd6a59","id":"61f3491a84794e79882bd4384ef7e083"},{"type":"Edge","source_node_id":"567d71473fb9439ab6e3f18f07524dbd","target_node_id":"eb9cee4423044f1b95bb6cda682f0c0b","branch_id":"1ec17f6a4b0748e587221d9032e82f60","id":"fc842a247deb402eba6a5c663fb6a00d","name":"1ec17f6a4b0748e587221d9032e82f60"},{"type":"Edge","source_node_id":"071db397feec4a36b72e9ba81db270e3","target_node_id":"eb9cee4423044f1b95bb6cda682f0c0b","id":"5c378e1cc3484e34a9b779e3f62911ea"},{"type":"Edge","source_node_id":"c22d8894214543288554a1331878a93e","target_node_id":"34a70a135f0d4f8ba10772a83b4972d0","id":"e2482f03f8c7474cabb27c8fe510a414"},{"type":"Edge","source_node_id":"a9c5b9119d2e4a9185f749f8539291f1","target_node_id":"183718c46b6f4bedaad8b1b71fb5e28b","id":"664d3828d8de48a5aac2a9aeeaecafe6"},{"type":"Edge","source_node_id":"183718c46b6f4bedaad8b1b71fb5e28b","target_node_id":"9b3c8873e2c04a0bb037f45a89791484","branch_id":"9390650143b94e5ebaff56fd8721ed08","id":"d93e409187e147c089282e33f4998e98","name":"9390650143b94e5ebaff56fd8721ed08"},{"type":"Edge","source_node_id":"9b3c8873e2c04a0bb037f45a89791484","target_node_id":"567d71473fb9439ab6e3f18f07524dbd","id":"ff5caaf149e844f6ad3647179a4018ff"},{"type":"Edge","source_node_id":"567d71473fb9439ab6e3f18f07524dbd","target_node_id":"03290de6059a4beaaa4b43668bdb6723","branch_id":"e64c9890045240fd9eca0c9279ed15bf","id":"956f074c7bf64577939c4245d162c628","name":"e64c9890045240fd9eca0c9279ed15bf"},{"type":"Edge","source_node_id":"df9335dbb94b47ec9213400d9fcd6a59","target_node_id":"071db397feec4a36b72e9ba81db270e3","id":"8ef9302080f642138d4a2ee77fed7498"},{"type":"Edge","source_node_id":"34a70a135f0d4f8ba10772a83b4972d0","target_node_id":"4441afeadc05411b96341a6c5238a400","id":"8e5ced8daef342ac955d78d3eeacb9c8"},{"type":"Edge","source_node_id":"4441afeadc05411b96341a6c5238a400","target_node_id":"a9c5b9119d2e4a9185f749f8539291f1","branch_id":"7288e8af3182464ebf1dc7f09fc3aa0c","id":"bd444c47150244bd81f4b911fa694ae7","name":"7288e8af3182464ebf1dc7f09fc3aa0c"},{"type":"Edge","source_node_id":"4441afeadc05411b96341a6c5238a400","target_node_id":"34a70a135f0d4f8ba10772a83b4972d0","branch_id":"a3697c2313684bb18349056317ed1608","id":"a6f69a23b4e144918cf664d62ad50a5e","name":"a3697c2313684bb18349056317ed1608"},{"type":"Edge","source_node_id":"183718c46b6f4bedaad8b1b71fb5e28b","target_node_id":"03290de6059a4beaaa4b43668bdb6723","branch_id":"1649bd28d89044549598846105f24782","id":"85d67eb049874961b02c02849488aa2c","name":"1649bd28d89044549598846105f24782"}],"id":"1382a1d852f44769a78cc05663b2e12c"}],"script_variables":[{"type":"String","name":"limit","value":{"type":"String","mode":"string","value":"5"},"id":"154c037921c546369fcdbfbd99814bd9"},{"type":"String","name":"count","value":{"type":"String","mode":"string","value":"0"},"id":"17f60cfd2c9643749d2d45e16da50f3e"},{"type":"String","name":"LiveAgent_application","value":{"type":"String","mode":"string","value":"itsm"},"id":"2b5ea6b3e16c4ba4858e7da69e8f7491"}],"glide_variables":[{"type":"String","name":"short_description","id":"4d2c1dcfdea04900aa19316a14aebc59"},{"type":"True/False","id":"9a9b464e0ec1425ea8619697cf4b469f","name":"is_helpful"},{"type":"Reference","table":"incident","id":"d9c89877002c4730ac8f57cf8742e56f","name":"create_incident"},{"type":"Choice","choices":[],"id":"6c9248abe9d840c6b134f0e237fe0569","name":"urgency","table":""}],"applicability":{"type":"Applicability","mode":"script","value":"(function execute() {\n    var gr = new GlideRecord('x_sthc_human_resou_hr_case_service_center');\n    return gr.canCreate();\n})()\n"},"roles":[],"scope":"5166e53e6f310f0061f06ea22e3ee44b","id":"f6d88a40db84801440f8fcfa0c96194c","name":"HR Case (LG)","key_phrases":["create","open","incident","ticket","issue","broken","help","IT"]}</design_definition>
        <design_topic_id>f6d88a40db84801440f8fcfa0c96194c</design_topic_id>
        <name>HR Case (LG)</name>
        <sys_class_name>sys_cb_design_topic</sys_class_name>
        <sys_created_by>LGOMEZ</sys_created_by>
        <sys_created_on>2019-09-17 21:01:02</sys_created_on>
        <sys_customer_update>false</sys_customer_update>
        <sys_domain>global</sys_domain>
        <sys_id>f6e90e08db84801440f8fcfa0c9619f3</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_name>FlowTopic</sys_name>
        <sys_package display_value="Human Resources" source="x_sthc_human_resou">5166e53e6f310f0061f06ea22e3ee44b</sys_package>
        <sys_policy/>
        <sys_replace_on_upgrade>false</sys_replace_on_upgrade>
        <sys_scope display_value="Human Resources">5166e53e6f310f0061f06ea22e3ee44b</sys_scope>
        <sys_update_name>sys_cb_design_topic_f6e90e08db84801440f8fcfa0c9619f3</sys_update_name>
        <sys_updated_by>LGOMEZ</sys_updated_by>
        <sys_updated_on>2019-09-17 21:01:02</sys_updated_on>
        <type>FlowTopic</type>
    </sys_cb_design_topic>
</record_update>
